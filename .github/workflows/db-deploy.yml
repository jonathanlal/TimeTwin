
name: DB Deploy
on:
  push:
    branches: [main]
    paths:
      - 'infra/supabase/**'
jobs:
  migrate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: supabase/setup-cli@v1
        with: { version: latest }
      - name: Apply migrations (prod)
        env:
          SUPABASE_DB_URL: ${{ secrets.SUPABASE_DB_URL_PROD }}
        run: |
          cd infra/supabase
          supabase db push --db-url "$SUPABASE_DB_URL"
